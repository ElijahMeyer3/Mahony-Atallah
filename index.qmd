---
title: "undergrad wellness"
format: live-html
webr:
  packages: 
    - tidyverse
    - scales
    - rlang
  cell-options:
    autorun: false
  resources:
    - https://raw.githubusercontent.com/ElijahMeyer3/Mahony-Atallah/main/data/kma_clean.csv
---

### Packages

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(rlang)
```

#### plot

```{webr-r}
#| edit: false
#| output: false

create_spaghetti_plot <- function(data,
                                  id_var,
                                  y_var,
                                  time_var,
                                  facet_var) {
  
  
  id_var    <- enquo(id_var)
  y_var     <- enquo(y_var)
  time_var  <- enquo(time_var)
  facet_var <- enquo(facet_var)
  uniqueid <- data$uniqueid
  
  # Remove NAs
  plot_data <- data |>
    filter(!is.na(!!y_var))
  
  # Compute means
  middle <- plot_data |>
    mutate(!!y_var := as.numeric(!!y_var)) |>
    group_by(!!time_var, !!facet_var) |>
    summarise(mean_score = mean(!!y_var), .groups = "drop")
  
  ggplot(plot_data, aes(
    y = !!y_var,
    x = !!time_var,
    group = !!id_var,
    color = factor(!!id_var)
  )) +
    geom_point() +
    geom_line() +
    
    # Mean points
    geom_point(data = middle,
               aes(x = !!time_var,
                   y = mean_score),
               inherit.aes = FALSE,
               size = 6,
               color = "red") +
    
    # Mean line
    geom_line(data = middle,
              aes(x = !!time_var,
                  y = mean_score,
                  group = !!facet_var),
              inherit.aes = FALSE,
              linewidth = 2,
              color = "black") +
    
    theme_minimal() +
    guides(color = "none") +
    facet_wrap(vars(!!facet_var))
}
```

```{webr-r}
create_spaghetti_plot(kma_clean, uniqueid, SCS_1, Time_text, Group_code)
```
